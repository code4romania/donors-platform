import:
  - recipe/laravel.php
  - contrib/php-fpm.php
  - deploy/tasks/npm.php
  - deploy/tasks/artisan.php

config:
  application: 'donors-platform'
  repository: 'https://github.com/code4romania/donors-platform.git'
  php_fpm_version: '8.0'
  remote_user: ubuntu
  writable_use_sudo: true

hosts:
  production:
    hostname: 'origin.platformadonatorilor.ro'
    deploy_path: '/var/www/production'
    labels:
      stage: production
  staging:
    hostname: 'platformadonatorilor.ro'
    deploy_path: '/var/www/staging'
    labels:
      stage: staging

tasks:
  deploy:
    - deploy:prepare
    - deploy:vendors
    - artisan:storage:link
    - artisan:view:cache
    - artisan:config:cache
    - artisan:route:cache
    - artisan:event:cache
    - artisan:migrate
    - assets:build
    - deploy:publish
    - php-fpm:reload
  assets:build:
    - npm:install
    - npm:build
    - npm:upload

after:
  deploy:failed: deploy:unlock
